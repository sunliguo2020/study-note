## 跨域问题梳理



### 1、浏览器的同源策略

浏览器处于安全的考虑，对同源请求放行，对异源请求限制，这些限制规则统称为同源策略。

### 什么是源？

源= 协议+域名+端口号

### 同源
源 =  协议+域名+端口
### 同源请求
页面源 ---->目标源

所处源与目标源不一致，就是“非同源”，又称“异源”或“跨域”



### 浏览器的同源策略
浏览器如何限制？
对标签发出的跨域请求轻微限制，对AJAX发出的跨域请求严厉限制。

### 2、跨域会收到哪些限制

例如：源A和源B，它们是非同源的，则浏览器会有如下限制：

1、DOM访问限制：源A的脚本不能读取和操作源B的DOM

2、Cookie的访问限制：源A不能访问源B的cookie.

3、Ajax响应数据限制：源A可以给源B发请求，但是无法获取源B的响应的数据。

备注：在上述限制中，浏览器对Ajax获取数据的限制是影响最大的一个，且实际开发中经常遇到。

### 3、几个注意点

1、跨域限制仅存在浏览器，服务端不存在跨域限制。

2、即使跨域了，Ajax请求也可以正常发出，但响应数据不会交给开发者。

3、<link> <script> <img> 这些标签发出的请求也可能跨域，只不过浏览器对标签跨域不做严格显示，对开发几乎无影响。

### 4、CORS解决Ajax跨域问题

#### 4.1 CORS概述

#### 4.2 CROS解决简单请求跨域

#### 4.3 简单请求与复杂请求

CORS将请求分为两大类：（简单请求和复杂请求)

### 简单请求：

- 请求方法：GET HEAD POST
- 头部字段满足CORS安全规范(简记：只要不手动修改请求头，一般都能符合该规范)
- 请求头的Content-Type为：
  - text/plain
  - multipart/form-data
  - application/x-www-form-urlencoded

### 复杂请求

1、不是简单请求，就是负责请求。

2、复杂请求会自动发送预检请求。

### 预检请求：

- 发送时机：预检请求在实际跨域请求之前发出，是由浏览器自动发起的
- 主要作用：用于服务器确认是否允许接下来的跨域请求。
- 基本流程：先发起OPTIONS请求，如果通过预检，继续发起实际的跨域请求。
- 请求头内容：一个OPTIONS预检请求，通常会包含如下的请求头：
  - Origin发起的请求源
  - Access-Control-Request-Method 实际请求的HTTP方法
  - Access-Control-Request-Headers 实际请求中使用的自定义头(如果有的话)
